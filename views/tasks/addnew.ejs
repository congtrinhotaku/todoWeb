<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0 rounded-3">
        <div class="card-header bg-success text-white fw-bold d-flex align-items-center">
          <i class="bi bi-plus-circle me-2"></i> Thêm công việc mới
        </div>
        <div class="card-body p-4">

          <!-- Form thêm công việc -->
          <form action="/tasks" method="POST" class="needs-validation" novalidate>

            <!-- Tiêu đề -->
            <div class="mb-3">
              <label for="title" class="form-label">Tiêu đề <span class="text-danger">*</span></label>
              <input type="text" name="title" id="title" class="form-control" required>
              <div class="invalid-feedback">Vui lòng nhập tiêu đề công việc.</div>
            </div>

            <!-- Mô tả -->
            <div class="mb-3">
              <label for="description" class="form-label">Mô tả</label>
              <textarea name="description" id="description" rows="3" class="form-control"></textarea>
            </div>

            <!-- Danh mục -->
            <div class="mb-3">
              <label for="category" class="form-label">Danh mục</label>
              <div class="input-group">
                <select name="category" id="category" class="form-select">
                  <option value="">-- Chọn danh mục --</option>
                  <% categories.forEach(cat => { %>
                    <option value="<%= cat._id %>"><%= cat.name %></option>
                  <% }) %>
                </select>
                <!-- Nút mở modal -->
                <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                  <i class="bi bi-plus-circle"></i>
                </button>
              </div>
            </div>

            <!-- Độ ưu tiên -->
            <div class="mb-3">
              <label for="priority" class="form-label">Độ ưu tiên</label>
              <select name="priority" id="priority" class="form-select">
                <option value="Không quan trọng">Không quan trọng</option>
                <option value="Quan trọng">Quan trọng</option>
                <option value="Khẩn cấp">Khẩn cấp</option>
              </select>
            </div>

            <!-- Trạng thái (ẩn, mặc định là "Chưa làm") -->
            <input type="hidden" name="status" value="Chưa làm">

            <!-- Thời gian bắt đầu -->
            <div class="mb-3">
              <label for="startTime" class="form-label">Thời gian bắt đầu</label>
              <input type="datetime-local" name="startTime" id="startTime" class="form-control">
            </div>

            <!-- Hạn chót -->
            <div class="mb-3">
              <label for="deadline" class="form-label">Hạn chót</label>
              <input type="datetime-local" name="deadline" id="deadline" class="form-control">
            </div>

            <!-- Thời lượng -->
            <div class="mb-3">
              <label for="duration" class="form-label">Thời lượng (giờ)</label>
              <input type="number" name="duration" id="duration" class="form-control" min="0">
            </div>

            <!-- Nhắc nhở -->
            <div class="mb-3">
              <label for="reminder" class="form-label">Nhắc nhở trước (phút)</label>
              <input type="number" name="reminder" id="reminder" class="form-control" min="0">
            </div>

            <!-- Nút hành động -->
            <div class="d-flex justify-content-between">
              <a href="/tasks" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Quay lại
              </a>
              <button type="submit" class="btn btn-success">
                <i class="bi bi-save"></i> Lưu công việc
              </button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>


<!-- ✅ Modal phải đặt ngoài form -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addCategoryModalLabel">Thêm danh mục mới</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="newCategory" class="form-label">Tên danh mục</label>
          <input type="text" id="newCategory" class="form-control" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
        <button type="button" id="btnSaveCategory" class="btn btn-primary">Thêm</button>
      </div>
    </div>
  </div>
</div>


<!-- Script check validation Bootstrap -->
<script>
  (() => {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>

<script src="/javascripts/addCategory.js"></script>
